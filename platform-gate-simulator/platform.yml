spec:
  inputs:
    job-prefix:
      # Mandatory string input
      default: ""
      description: "Define a prefix for the job name"
    job-stage:
      # Optional string input with a default value when not provided
      default: build_and_deploy
---
variables:
  MAVEN_GROUPEID: eu.efti
  MAVEN_ARTIFACTID: platform-gate-simulator
  MAVEN_EXTENSION: jar
  VERSION_ARTEFACT_SNAPSHOT: 0.5.3-SNAPSHOT
  VERSION_ARTEFACT_RELEASE: 0.5.2

"$[[ inputs.job-prefix | expand_vars ]]_build_and_deploy_microservices":
  stage: $[[ inputs.job-stage ]]
  rules:
  - if: $DEPLOY_ENVIRONMENT == "dev" || $DEPLOY_ENVIRONMENT == "int"
    when: always
  - if: $CI_COMMIT_REF_NAME =~ /feat/
    variables:
      TAG: PREVIEW
    when: manual
  trigger:
    include:
    - project: $PROJECT #"kube/build"
      file: $FICHIER #"template/projects/efti/microservice.yml"
      ref: $REF #"kustomize"
    forward:
      pipeline_variables: true
    strategy: depend
