spec:
  inputs:
    job-prefix:     # Mandatory string input
      default: ""
      description: "Define a prefix for the job name"
    job-stage:      # Optional string input with a default value when not provided
      default: build_and_deploy
---
variables:
  MAVEN_GROUPEID: com.ingroupe.efti
  MAVEN_ARTIFACTID: efti-portal
  MAVEN_EXTENSION: tar
  VERSION_ARTEFACT_SNAPSHOT: 1.0-SNAPSHOT
  VERSION_ARTEFACT_RELEASE: 0.4.0

"$[[ inputs.job-prefix | expand_vars ]]_build_and_deploy_portal_hors_prod":
  stage: $[[ inputs.job-stage ]]
  rules:
    - if: $DEPLOY_ENVIRONMENT == "dev" || $DEPLOY_ENVIRONMENT == "int"
      when: always
    - if: $CI_COMMIT_REF_NAME =~ /feat/
      variables:
        TAG: PREVIEW
      when: manual
  trigger:
    include:
      - project: "kube/build"
        file: "template/projects/efti/portal.yml"
        ref: "kustomize"
    forward:
      pipeline_variables: true
    strategy: depend
