spec:
  inputs:
    job-prefix:     # Mandatory string input
      default: ""
      description: "Define a prefix for the job name"
    job-stage:      # Optional string input with a default value when not provided
      default: build_and_deploy
---
variables:
  # MAVEN_GROUPEID: eu.efti
  MAVEN_GROUPEID: com.ingroupe.efti
  MAVEN_ARTIFACTID: efti-gate
  MAVEN_EXTENSION: jar
  VERSION_ARTEFACT_SNAPSHOT: 0.4.2-SNAPSHOT
  VERSION_ARTEFACT_RELEASE: 0.4.1
  FLUENT: "true"

"$[[ inputs.job-prefix | expand_vars ]]_build_and_deploy_microservices":
  stage: $[[ inputs.job-stage ]]
  rules:
    - if: $DEPLOY_ENVIRONMENT == "dev" || $DEPLOY_ENVIRONMENT == "int"
      when: always
    - if: $CI_COMMIT_REF_NAME =~ /feat/
      variables:
        TAG: PREVIEW
      when: manual
    - when: always
  trigger:
    include:
      - project: "kube/build/template/projects/efti/"
        file: "build.yml"
        ref: "kustomize"
    forward:
      pipeline_variables: true
    strategy: depend

  # script:
  # - echo "I'm environment $DEPLOY_ENVIRONMENT && $COMPONENT"